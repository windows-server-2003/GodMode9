set PREVIEW_MODE "Checking GodMode9 version"

set ERR_MSG_VER "Unsupported version\n \nThis script only supports\nversions between 1.5.0 and 1.6.3,\nMTmod 1.1 and below."

# Red Unlocker for versions between 1.5.0 and 1.6.3
# author : windows-server-2003(QCFium)
# permissions : none
# This script will unlock the SysNAND level3 writing permission(Red)
# without any permissions.

# RUN THIS AT YOUR OWN RISK
# I am not responsible for anything

# check version - check the hash of the top 256KB of the firm
set ERRORMSG $[ERR_MSG_VER] # instead of "'if' command not found" for lower versions
shaget M:/arm9.mem@6000:40000 VERSION_SHA
if chk $[VERSION_SHA] AF01396C62963613DFE5F5E36B06C9863ED733F05F14ED73B037C259D3BA2E6C
    ######## 1.5.0
    set GM9_VERSION "1.5.0"
    set ADDRESS ∞
elif chk $[VERSION_SHA] 31DF2A11BF4514F1B8C8D3B12EA738733CFFA301364499CF33DF4B8B48111C86
    ######## 1.5.1
    set GM9_VERSION "1.5.1"
    set ADDRESS 8&
elif chk $[VERSION_SHA] 422FA3B196F8850C4CBB42F886AD1158452BBDE00EA390FD87A952319C711BB1
    ######## 1.6.0
    set GM9_VERSION "1.6.0"
    set ADDRESS àa
elif chk $[VERSION_SHA] D33C7C683648D1BAD659307F7C93A19006FCFF67317181A537CFE997E5CD2B57
	######## 1.6.1
	set GM9_VERSION "1.6.1\n2nd Anniversary Edition"
	set ADDRESS 8i
elif chk $[VERSION_SHA] F6310ACD3EE1D07256AE4BDFC73B89EEE19DDECAEF143C672E0CD59B9A48B8E6
	######## 1.6.2
	set GM9_VERSION "1.6.2\nApril fools 2018 Edition"
	set ADDRESS (Ñ
elif chk $[VERSION_SHA] 68B10C2FCC085F29B5BB9A4E8FA5035D3962CAED1211C22D16C968CD0329F3EE
	######## 1.6.3
	set GM9_VERSION "1.6.3"
	set ADDRESS 8Ù
elif chk $[VERSION_SHA] A9631E7AFEDFDD0812B60C1E8EBD89ED63CBE1F6FDB5DE16DC2BDFE824259E80
	######## Initial MTmod
	set GM9_VERSION "MTmod 0.0(Initial Release)"
	set ADDRESS H2
elif chk $[VERSION_SHA] 689273BA5F19CC3F309100A6242A2C1AE644B096D5687AE26F9A5B791DA6054B
	######## MTmod 1.0
	set GM9_VERSION "MTmod 1.0"
	set ADDRESS ¯t
elif chk $[VERSION_SHA] D07615CAD744A6261AF8E2FF2CFED693A5AFF4BD5B74966889DF7022CAA27614
	######## MTmod 1.1
	set GM9_VERSION "MTmod 1.1"
	set ADDRESS »Å
else
    # version not supported
    set ERRORMSG $[ERR_MSG_VER]
    cp 0 0 # force fail
end

## actual operations
# ask user
    set PREVIEW_MODE "Version : $[GM9_VERSION]\n \nAsking user"
    set SUCCESSMSG "The red permission unlocked.\n \nTo say :\nScripts are dangerous."
    ask -s "RedUnlocker $[GM9_VERSION]\n \nThis script will unlock\nall the write permissions.\n \nCONTINUE AT YOUR OWN RISK"

# actual unlocking
    set PREVIEW_MODE "Version : $[GM9_VERSION]\n \nUnlocking the red permission"
    set ERRORMSG "Unknown error"
	
	# this is the magic
	set PREVIEW_MODE $[ADDRESS]%%65531c%%3$hn
	set PREVIEW_MODE " "
